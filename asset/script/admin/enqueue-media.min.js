jQuery(document).ready(function($){var file_frame;$(document.body).on('click','.custom_media_upload',function(event){var $el=$(this);var file_target_input=$el.parent().find('.custom_media_input');var file_target_preview=$el.parent().find('.custom_media_preview');event.preventDefault();file_frame=wp.media.frames.media_file=wp.media({title:$el.data('choose'),button:{text:$el.data('update')},states:[new wp.media.controller.Library({title:$el.data('choose'),library:wp.media.query({type:'image'})})]});file_frame.on('select',function(){var attachment=file_frame.state().get('selection').first().toJSON();file_target_input.val(attachment.url).change();file_target_preview.css({display:'none'}).find('img').remove();file_target_preview.css({display:'block'}).append('<img src="'+attachment.url+'" style="max-width:100%">')});file_frame.open()});$('input.custom_media_input').each(function(){var preview_image=$(this).val(),preview_target=$(this).siblings('.custom_media_preview');if(preview_image!==''){preview_target.find('img.custom_media_preview_default').remove();preview_target.css({display:'block'}).append('<img src="'+preview_image+'" style="max-width:100%">')}})});